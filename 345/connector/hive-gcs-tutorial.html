
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="2196f3">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Hive Connector GCS Tutorial &#8212; Presto 345 Documentation</title>
    <link rel="stylesheet" href="../_static/material.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/presto.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Hive Connector Storage Caching" href="hive-caching.html" />
    <link rel="prev" title="Hive Connector with Azure Storage" href="hive-azure.html" />
  
   

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-133457846-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-133457846-1');
    </script>
  </head>
  <body dir=ltr
        data-md-color-primary=blue-grey data-md-color-accent=light-blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#connector/hive-gcs-tutorial" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="Presto 345 Documentation"
           class="md-header-nav__button md-logo">
          
              <img src="../_static/presto.svg" height="26"
                   alt="Presto 345 Documentation logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Presto 345 Documentation</span>
          <span class="md-header-nav__topic"> Hive Connector GCS Tutorial </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/prestosql/presto" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Presto
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../../versions.json",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    <!-- empty -->
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="Presto 345 Documentation" class="md-nav__button md-logo">
      
        <img src="../_static/presto.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="Presto 345 Documentation">Presto 345 Documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/prestosql/presto" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Presto
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../overview.html" class="md-nav__link">Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../installation.html" class="md-nav__link">Installation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../client.html" class="md-nav__link">Clients</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../security.html" class="md-nav__link">Security</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../admin.html" class="md-nav__link">Administration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../optimizer.html" class="md-nav__link">Query Optimizer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../connector.html" class="md-nav__link">Connectors</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="accumulo.html" class="md-nav__link">Accumulo</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="bigquery.html" class="md-nav__link">BigQuery</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="blackhole.html" class="md-nav__link">Black Hole</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="cassandra.html" class="md-nav__link">Cassandra</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="druid.html" class="md-nav__link">Druid</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="elasticsearch.html" class="md-nav__link">Elasticsearch</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="googlesheets.html" class="md-nav__link">Google Sheets</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="iceberg.html" class="md-nav__link">Iceberg</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hive.html" class="md-nav__link">Hive</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="hive-security.html" class="md-nav__link">Security</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hive-s3.html" class="md-nav__link">Amazon S3</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hive-azure.html" class="md-nav__link">Azure Storage</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> GCS Tutorial </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">GCS Tutorial</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
    <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#preliminary-steps" class="md-nav__link">Preliminary Steps</a><nav class="md-nav">
                <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#ensure-access-to-gcs" class="md-nav__link">Ensure Access to GCS</a>
        </li>
        <li class="md-nav__item"><a href="#hive-connector-configuration" class="md-nav__link">Hive Connector configuration</a>
        </li>
        <li class="md-nav__item"><a href="#hive-metastore-configuration" class="md-nav__link">Hive Metastore configuration</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#accessing-gcs-data-from-presto-for-the-first-time" class="md-nav__link">Accessing GCS Data From Presto for the First Time</a><nav class="md-nav">
                <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#accessing-data-already-mapped-in-the-hive-metastore" class="md-nav__link">Accessing Data Already Mapped in the Hive metastore</a>
        </li>
        <li class="md-nav__item"><a href="#accessing-data-not-yet-mapped-in-the-hive-metastore" class="md-nav__link">Accessing Data Not Yet Mapped in the Hive metastore</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#writing-gcs-data-with-presto" class="md-nav__link">Writing GCS Data with Presto</a><nav class="md-nav">
                <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#prerequisites" class="md-nav__link">Prerequisites</a>
        </li>
        <li class="md-nav__item"><a href="#create-export-schema" class="md-nav__link">Create Export Schema</a>
        </li>
        <li class="md-nav__item"><a href="#export-data-to-gcs" class="md-nav__link">Export Data to GCS</a>
        </li></ul>
            </nav>
        </li>
    </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hive-caching.html" class="md-nav__link">Storage Caching</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hive-alluxio.html" class="md-nav__link">Alluxio</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="jmx.html" class="md-nav__link">JMX</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="kafka.html" class="md-nav__link">Kafka</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="kinesis.html" class="md-nav__link">Kinesis</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="kudu.html" class="md-nav__link">Kudu</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="localfile.html" class="md-nav__link">Local File</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="memory.html" class="md-nav__link">Memory</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="memsql.html" class="md-nav__link">MemSQL</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="mongodb.html" class="md-nav__link">MongoDB</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="mysql.html" class="md-nav__link">MySQL</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="oracle.html" class="md-nav__link">Oracle</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="phoenix.html" class="md-nav__link">Phoenix</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="pinot.html" class="md-nav__link">Pinot</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="postgresql.html" class="md-nav__link">PostgreSQL</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="prometheus.html" class="md-nav__link">Prometheus</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="redis.html" class="md-nav__link">Redis</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="redshift.html" class="md-nav__link">Redshift</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="sqlserver.html" class="md-nav__link">SQL Server</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="system.html" class="md-nav__link">System</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="thrift.html" class="md-nav__link">Thrift</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="tpcds.html" class="md-nav__link">TPCDS</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="tpch.html" class="md-nav__link">TPCH</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../functions.html" class="md-nav__link">Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../language.html" class="md-nav__link">SQL Language</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../sql.html" class="md-nav__link">SQL Statement Syntax</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../migration.html" class="md-nav__link">Migration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../develop.html" class="md-nav__link">Developer Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../release.html" class="md-nav__link">Release Notes</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
    <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#preliminary-steps" class="md-nav__link">Preliminary Steps</a><nav class="md-nav">
                <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#ensure-access-to-gcs" class="md-nav__link">Ensure Access to GCS</a>
        </li>
        <li class="md-nav__item"><a href="#hive-connector-configuration" class="md-nav__link">Hive Connector configuration</a>
        </li>
        <li class="md-nav__item"><a href="#hive-metastore-configuration" class="md-nav__link">Hive Metastore configuration</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#accessing-gcs-data-from-presto-for-the-first-time" class="md-nav__link">Accessing GCS Data From Presto for the First Time</a><nav class="md-nav">
                <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#accessing-data-already-mapped-in-the-hive-metastore" class="md-nav__link">Accessing Data Already Mapped in the Hive metastore</a>
        </li>
        <li class="md-nav__item"><a href="#accessing-data-not-yet-mapped-in-the-hive-metastore" class="md-nav__link">Accessing Data Not Yet Mapped in the Hive metastore</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#writing-gcs-data-with-presto" class="md-nav__link">Writing GCS Data with Presto</a><nav class="md-nav">
                <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#prerequisites" class="md-nav__link">Prerequisites</a>
        </li>
        <li class="md-nav__item"><a href="#create-export-schema" class="md-nav__link">Create Export Schema</a>
        </li>
        <li class="md-nav__item"><a href="#export-data-to-gcs" class="md-nav__link">Export Data to GCS</a>
        </li></ul>
            </nav>
        </li>
    </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<h1 id="connector-hive-gcs-tutorial--page-root">Hive Connector GCS Tutorial<a class="headerlink" href="#connector-hive-gcs-tutorial--page-root" title="Permalink to this headline">#</a></h1>

<h2 id="preliminary-steps">Preliminary Steps<a class="headerlink" href="#preliminary-steps" title="Permalink to this headline">#</a></h2>

<h3 id="ensure-access-to-gcs">Ensure Access to GCS<a class="headerlink" href="#ensure-access-to-gcs" title="Permalink to this headline">#</a></h3>
<p>The <a class="reference internal" href="hive.html"><span class="doc">Hive Connector</span></a> can access
<a class="reference external" href="https://cloud.google.com/storage/">Google Cloud Storage</a> data using the
<a class="reference external" href="https://cloud.google.com/dataproc/docs/concepts/connectors/cloud-storage">Cloud Storage connector</a>.</p>
<p>If your data is publicly available, you do not need to do anything here.
However, in most cases data is not publicly available, and the Presto cluster needs to have access to it.
This is typically achieved by creating a service account, which has permissions to access your data.
You can do this on the
<a class="reference external" href="https://console.cloud.google.com/projectselector2/iam-admin/serviceaccounts">service accounts page in GCP</a>.
Once you create a service account, create a key for it and download the key in JSON format.</p>


<h3 id="hive-connector-configuration">Hive Connector configuration<a class="headerlink" href="#hive-connector-configuration" title="Permalink to this headline">#</a></h3>
<p>Another requirement is that you have enabled and configured a Hive connector in Presto.
The connector uses Hive metastore for data discovery and is not limited to data residing on HDFS.</p>
<p><strong>Configuring Hive Connector</strong></p>
<ul>
<li><p>URL to Hive metastore:</p>
<ul>
<li><p>New Hive metastore on GCP:</p>
<p>If your Presto nodes are provisioned by GCP, your Hive metastore should also be on GCP
to minimize latency and costs. The simplest way to create a new Hive metastore on GCP
is to create a small Cloud DataProc cluster (1 master, 0 workers), accessible from
your Presto cluster. Follow the steps for existing Hive metastore after finishing this step.</p>
</li>
<li><p>Existing Hive metastore:</p>
<p>To use an existing Hive metastore with a Presto cluster, you need to set the
<code class="docutils literal notranslate"><span class="pre">hive.metastore.uri</span></code> property in your Hive catalog properties file to
<code class="docutils literal notranslate"><span class="pre">thrift://${METASTORE_ADDRESS}:${METASTORE_THRIFT_PORT}</span></code>.
If the metastore uses authentication, please refer to <a class="reference internal" href="hive-security.html"><span class="doc">Hive Connector Security Configuration</span></a>.</p>
</li>
</ul>
</li>
<li><p>GCS access:</p>
<p>Here are example values for all GCS configuration properties which can be set in Hive
catalog properties file:</p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="c"># JSON key file used to access Google Cloud Storage</span>
<span class="na">hive.gcs.json-key-file-path</span><span class="o">=</span><span class="s">/path/to/gcs_keyfile.json</span>

<span class="c"># Use client-provided OAuth token to access Google Cloud Storage</span>
<span class="na">hive.gcs.use-access-token</span><span class="o">=</span><span class="s">false</span>
</pre></div>
</div>
</li>
</ul>


<h3 id="hive-metastore-configuration">Hive Metastore configuration<a class="headerlink" href="#hive-metastore-configuration" title="Permalink to this headline">#</a></h3>
<p>If your Hive metastore uses StorageBasedAuthorization, it needs to access GCS
to perform POSIX permission checks.
Configuring GCS access for Hive is outside the scope of this tutorial, but there
are some excellent guides online:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://cloud.google.com/dataproc/docs/concepts/connectors/install-storage-connector">Google: Installing the Cloud Storage connector</a></p></li>
<li><p><a class="reference external" href="https://docs.hortonworks.com/HDPDocuments/HDP3/HDP-3.1.0/bk_cloud-data-access/content/gcp-get-started.html">HortonWorks: Working with Google Cloud Storage</a></p></li>
<li><p><a class="reference external" href="https://www.cloudera.com/documentation/enterprise/latest/topics/admin_gcs_config.html">Cloudera: Configuring Google Cloud Storage Connectivity</a></p></li>
</ul>
<p>GCS access is typically configured in <code class="docutils literal notranslate"><span class="pre">core-site.xml</span></code>, to be used by all components using Apache Hadoop.</p>
<p>GCS connector for Hadoop provides an implementation of a Hadoop FileSystem.
Unfortunately GCS IAM permissions don’t map to POSIX permissions required by Hadoop FileSystem,
so the GCS connector presents fake POSIX file permissions.</p>
<p>When Hive metastore accesses GCS, it see fake POSIX permissions equal to <code class="docutils literal notranslate"><span class="pre">0700</span></code> by default.
If Presto and Hive metastore are running as different user accounts, this causes Hive metastore
to deny Presto data access.
There are two possible solutions to this problem:</p>
<ul class="simple">
<li><p>Run Presto service and Hive service as the same user.</p></li>
<li><p>Make sure Hive GCS configuration includes a <code class="docutils literal notranslate"><span class="pre">fs.gs.reported.permissions</span></code> property
with a value of <code class="docutils literal notranslate"><span class="pre">777</span></code>.</p></li>
</ul>



<h2 id="accessing-gcs-data-from-presto-for-the-first-time">Accessing GCS Data From Presto for the First Time<a class="headerlink" href="#accessing-gcs-data-from-presto-for-the-first-time" title="Permalink to this headline">#</a></h2>

<h3 id="accessing-data-already-mapped-in-the-hive-metastore">Accessing Data Already Mapped in the Hive metastore<a class="headerlink" href="#accessing-data-already-mapped-in-the-hive-metastore" title="Permalink to this headline">#</a></h3>
<p>If you migrate to Presto from Hive, chances are that your GCS data is already mapped to
SQL tables in the metastore.
In that case, you should be able to query it.</p>


<h3 id="accessing-data-not-yet-mapped-in-the-hive-metastore">Accessing Data Not Yet Mapped in the Hive metastore<a class="headerlink" href="#accessing-data-not-yet-mapped-in-the-hive-metastore" title="Permalink to this headline">#</a></h3>
<p>To access GCS data that is not yet mapped in the Hive metastore you need to provide the
schema of the data, the file format, and the data location.
For example, if you have ORC or Parquet files in an GCS bucket <code class="docutils literal notranslate"><span class="pre">my_bucket</span></code>, you need to execute a query:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- select schema in which the table will be defined, must already exist</span>
<span class="n">USE</span> <span class="n">hive</span><span class="p">.</span><span class="k">default</span><span class="p">;</span>

<span class="c1">-- create table</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">orders</span> <span class="p">(</span>
     <span class="n">orderkey</span> <span class="nb">bigint</span><span class="p">,</span>
     <span class="n">custkey</span> <span class="nb">bigint</span><span class="p">,</span>
     <span class="n">orderstatus</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
     <span class="n">totalprice</span> <span class="n">double</span><span class="p">,</span>
     <span class="n">orderdate</span> <span class="nb">date</span><span class="p">,</span>
     <span class="n">orderpriority</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span>
     <span class="n">clerk</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span>
     <span class="n">shippriority</span> <span class="nb">integer</span><span class="p">,</span>
     <span class="k">comment</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">79</span><span class="p">)</span>
<span class="p">)</span> <span class="k">WITH</span> <span class="p">(</span>
     <span class="n">external_location</span> <span class="o">=</span> <span class="s1">'gs://my_bucket/path/to/folder'</span><span class="p">,</span>
     <span class="n">format</span> <span class="o">=</span> <span class="s1">'ORC'</span> <span class="c1">-- or 'PARQUET'</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Now you should be able to query the newly mapped table:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">orders</span><span class="p">;</span>
</pre></div>
</div>



<h2 id="writing-gcs-data-with-presto">Writing GCS Data with Presto<a class="headerlink" href="#writing-gcs-data-with-presto" title="Permalink to this headline">#</a></h2>

<h3 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">#</a></h3>
<p>Before you attempt to write data to GCS, make sure you have configured everything
necessary to read data from GCS.</p>


<h3 id="create-export-schema">Create Export Schema<a class="headerlink" href="#create-export-schema" title="Permalink to this headline">#</a></h3>
<p>If Hive metastore contains schema(s) mapped to GCS locations, you can use them to
export data to GCS.
If you don’t want to use existing schemas, or there are no appropriate schemas in
the Hive metastore, you need to create a new one:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">hive</span><span class="p">.</span><span class="n">gcs_export</span> <span class="k">WITH</span> <span class="p">(</span><span class="k">location</span> <span class="o">=</span> <span class="s1">'gs://my_bucket/some/path'</span><span class="p">);</span>
</pre></div>
</div>


<h3 id="export-data-to-gcs">Export Data to GCS<a class="headerlink" href="#export-data-to-gcs" title="Permalink to this headline">#</a></h3>
<p>Once you have a schema pointing to a location, where you want to export the data, you can issue
the export using a <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span> <span class="pre">AS</span></code> statement and select your desired file format. The data
is written to one or more files within the <code class="docutils literal notranslate"><span class="pre">gs://my_bucket/some/path/my_table</span></code> namespace.
Example:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">hive</span><span class="p">.</span><span class="n">gcs_export</span><span class="p">.</span><span class="n">orders_export</span>
<span class="k">WITH</span> <span class="p">(</span><span class="n">format</span> <span class="o">=</span> <span class="s1">'ORC'</span><span class="p">)</span>
<span class="k">AS</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">tpch</span><span class="p">.</span><span class="n">sf1</span><span class="p">.</span><span class="n">orders</span><span class="p">;</span>
</pre></div>
</div>





          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="hive-azure.html" title="Hive Connector with Azure Storage"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Hive Connector with Azure Storage </span>
              </div>
            </a>
          
          
            <a href="hive-caching.html" title="Hive Connector Storage Caching"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Hive Connector Storage Caching </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>