
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>7.13. Hive Connector with Alluxio &#8212; Presto 338 Documentation</title>
    <link rel="stylesheet" href="../_static/presto.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '338',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7.14. JMX Connector" href="jmx.html" />
    <link rel="prev" title="7.12. Hive Connector with Azure Storage" href="hive-azure.html" /> 
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-133457846-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-133457846-1');
    </script>
  </head>
  <body>
<div class="header">
    <span style="float: right; margin-top: 20px;">
        <a href="/slack.html">
            <img height="24" src="https://img.shields.io/badge/Slack-ask%20for%20help-44af5c.svg?logo=slack">
        </a>
    </span>
    <h1 class="heading"><a href="../index.html">
        <span>Presto 338 Documentation</span></a></h1>
    <h2 class="heading"><span>7.13. Hive Connector with Alluxio</span></h2>
</div>
<div class="topnav">
    
<p class="nav">
    <span class="left">
        &laquo; <a href="hive-azure.html">7.12. Hive Connector with Azure Storage</a>
    </span>
    <span class="right">
        <a href="jmx.html">7.14. JMX Connector</a> &raquo;
    </span>
</p>

</div>
<div class="content">
    
  <div class="section" id="hive-connector-with-alluxio">
<h1>7.13. Hive Connector with Alluxio<a class="headerlink" href="#hive-connector-with-alluxio" title="Permalink to this headline">#</a></h1>
<p>Presto can read and write tables stored in the <a class="reference external" href="https://www.alluxio.io/?utm_source=prestosql&amp;utm_medium=prestodocs">Alluxio Data Orchestration
System</a>,
leveraging Alluxio’s distributed block-level read/write caching functionality.
The tables must be created in the Hive metastore with the <code class="docutils literal"><span class="pre">alluxio://</span></code>
location prefix (see <a class="reference external" href="https://docs.alluxio.io/os/user/2.1/en/compute/Hive.html?utm_source=prestosql&amp;utm_medium=prestodocs">Running Apache Hive with Alluxio</a>
for details and examples).</p>
<p>Presto queries will then transparently retrieve and cache files or objects from
a variety of disparate storage systems including HDFS and S3.</p>
<div class="section" id="alluxio-client-side-configuration">
<h2>Alluxio client-side configuration<a class="headerlink" href="#alluxio-client-side-configuration" title="Permalink to this headline">#</a></h2>
<p>To configure Alluxio client-side properties on Presto, append the Alluxio
configuration directory (<code class="docutils literal"><span class="pre">${ALLUXIO_HOME}/conf</span></code>) to the Presto JVM classpath,
so that the Alluxio properties file <code class="docutils literal"><span class="pre">alluxio-site.properties</span></code> can be loaded as
a resource. Update the Presto <a class="reference internal" href="../installation/deployment.html#presto-jvm-config"><span class="std std-ref">JVM Config</span></a> file <code class="docutils literal"><span class="pre">etc/jvm.config</span></code>
to include the following:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>-Xbootclasspath/a:&lt;path-to-alluxio-conf&gt;
</pre></div>
</div>
<p>The advantage of this approach is that all the Alluxio properties are set in
the single <code class="docutils literal"><span class="pre">alluxio-site.properties</span></code> file. For details, see <a class="reference external" href="https://docs.alluxio.io/os/user/2.1/en/compute/Presto.html#customize-alluxio-user-properties?utm_source=prestosql&amp;utm_medium=prestodocs">Customize Alluxio User Properties</a>.</p>
<p>Alternatively, add Alluxio configuration properties to the Hadoop configuration
files (<code class="docutils literal"><span class="pre">core-site.xml</span></code>, <code class="docutils literal"><span class="pre">hdfs-site.xml</span></code>) and configure the Hive connector
to use the <a class="reference external" href="#hdfs-configuration">Hadoop configuration files</a> via the
<code class="docutils literal"><span class="pre">hive.config.resources</span></code> connector property.</p>
</div>
<div class="section" id="deploy-alluxio-with-presto">
<h2>Deploy Alluxio with Presto<a class="headerlink" href="#deploy-alluxio-with-presto" title="Permalink to this headline">#</a></h2>
<p>To achieve the best performance running Presto on Alluxio, it is recommended
to collocate Presto workers with Alluxio workers. This allows reads and writes
to bypass the network (<em>short-circuit</em>). See <a class="reference external" href="https://www.alluxio.io/blog/top-5-performance-tuning-tips-for-running-presto-on-alluxio-1/?utm_source=prestosql&amp;utm_medium=prestodocs">Performance Tuning Tips for Presto with Alluxio</a>
for more details.</p>
</div>
<div class="section" id="alluxio-catalog-service">
<span id="id1"></span><h2>Alluxio Catalog Service<a class="headerlink" href="#alluxio-catalog-service" title="Permalink to this headline">#</a></h2>
<p>An alternative way for Presto to interact with Alluxio is via the
<a class="reference external" href="https://docs.alluxio.io/os/user/stable/en/core-services/Catalog.html?utm_source=prestosql&amp;utm_medium=prestodocs">Alluxio catalog service</a>.
The primary benefits for using the Alluxio catalog service are simpler
deployment of Alluxio with Presto, and enabling schema-aware optimizations
such as transparent caching and transformations. Currently, the catalog service
supports read-only workloads.</p>
<p>The Alluxio catalog service is a metastore that can cache the information
from different underlying metastores. It currently supports the Hive metastore
as an underlying metastore. In order for the Alluxio catalog to manage the metadata
of other existing metastores, the other metastores must be “attached” to the
Alluxio catalog. To attach an existing Hive metastore to the Alluxio
catalog, simply use the
<a class="reference external" href="https://docs.alluxio.io/os/user/stable/en/operation/User-CLI.html?utm_source=prestosql&amp;utm_medium=prestodocs#attachdb">Alluxio CLI attachdb command</a>.
The appropriate Hive metastore location and Hive database name need to be
provided.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>./bin/alluxio table attachdb hive thrift://HOSTNAME:9083 hive_db_name
</pre></div>
</div>
<p>Once a metastore is attached, the Alluxio catalog can manage and serve the
information to Presto. To configure the Hive connector for Alluxio
catalog service, simply configure the connector to use the Alluxio
metastore type, and provide the location to the Alluxio cluster.
For example, your <code class="docutils literal"><span class="pre">etc/catalog/alluxio.properties</span></code> should include
the following:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>connector.name=hive-hadoop2
hive.metastore=alluxio
hive.metastore.alluxio.master.address=HOSTNAME:PORT
</pre></div>
</div>
<p>Replace <code class="docutils literal"><span class="pre">HOSTNAME</span></code> with the Alluxio master hostname, and replace <code class="docutils literal"><span class="pre">PORT</span></code>
with the Alluxio master port.
An example of an Alluxio master address is <code class="docutils literal"><span class="pre">master-node:19998</span></code>.
Now, Presto queries can take advantage of the Alluxio catalog service, such as
transparent caching and transparent transformations, without any modifications
to existing Hive metastore deployments.</p>
</div>
</div>


</div>
<div class="bottomnav">
    
<p class="nav">
    <span class="left">
        &laquo; <a href="hive-azure.html">7.12. Hive Connector with Azure Storage</a>
    </span>
    <span class="right">
        <a href="jmx.html">7.14. JMX Connector</a> &raquo;
    </span>
</p>

</div>

    <div class="footer" role="contentinfo">
    </div>
  </body>
</html>